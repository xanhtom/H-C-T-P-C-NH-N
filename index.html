<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Web Há»c Táº­p â€“ Thi Trá»±c Tuyáº¿n</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body{font-family:Arial;background:#f2f4f8;margin:0}
header{background:#34495e;color:white;padding:15px;text-align:center}
section{padding:20px}
.card{background:white;padding:15px;border-radius:8px;margin-bottom:15px}
button{padding:8px 12px;margin-top:5px}
.hidden{display:none}
.admin{color:red;font-weight:bold}
table{width:100%;border-collapse:collapse}
td,th{border:1px solid #ccc;padding:6px}
</style>
</head>

<body>

<header>
<h2>ğŸ“ Há»† THá»NG THI & Há»ŒC Táº¬P</h2>
<span id="info"></span>
</header>

<section id="login">
<div class="card">
<h3>ÄÄƒng nháº­p</h3>
<input id="username" placeholder="TÃªn"><br><br>
<select id="role">
<option value="user">Há»c sinh</option>
<option value="admin">GiÃ¡o viÃªn</option>
</select><br><br>
<button onclick="login()">ÄÄƒng nháº­p</button>
</div>
</section>

<section id="userDash" class="hidden">
<div class="card">
<h3>ğŸ“¤ Upload Ä‘á» (Word/PDF)</h3>
<input type="file" onchange="uploadExam(this)">
<p id="uploadStatus"></p>
</div>

<div class="card">
<h3>ğŸ“ Thi tráº¯c nghiá»‡m</h3>
<p id="q"></p>
<div id="opts"></div>
<button onclick="submit()">Ná»™p</button>
</div>

<div class="card">
<h3>ğŸ“„ Xuáº¥t báº£ng Ä‘iá»ƒm</h3>
<button onclick="exportPDF()">Xuáº¥t PDF</button>
</div>
</section>

<section id="adminDash" class="hidden">
<div class="card admin">
<h3>ğŸ›¡ï¸ Log gian láº­n</h3>
<ul id="logs"></ul>
</div>

<div class="card">
<h3>ğŸ§  AI Ä‘Ã¡nh giÃ¡ gian láº­n</h3>
<table>
<tr><th>TÃªn</th><th>Äiá»ƒm nghi váº¥n</th><th>Káº¿t luáº­n</th></tr>
<tbody id="aiTable"></tbody>
</table>
</div>
</section>

<script>
let user=null,score=0,aiScore=0,startTime=Date.now()
let bank=[{q:"1+1=?",a:["1","2","3","4"],c:1}]
let curQ=null

function login(){
  user={name:username.value,role:role.value}
  login.classList.add("hidden")
  if(user.role==="user") userDash.classList.remove("hidden")
  else adminDash.classList.remove("hidden")
  info.innerText=user.role==="admin"?"ğŸ‘‘ Admin":"ğŸ“ User"
  loadQ()
}

function uploadExam(input){
  uploadStatus.innerText="ğŸ“„ ÄÃ£ nháº­n file (mÃ´ phá»ng Ä‘á»c Word/PDF)"
}

function loadQ(){
  curQ=bank[Math.floor(Math.random()*bank.length)]
  q.innerText=curQ.q
  opts.innerHTML=""
  curQ.a
    .map((v,i)=>({v,i}))
    .sort(()=>Math.random()-0.5)
    .forEach(x=>{
      opts.innerHTML+=`<div><input type="radio" name="o" value="${x.i}"> ${x.v}</div>`
    })
}

function submit(){
  const c=document.querySelector("input[name=o]:checked")
  if(!c) return
  if(+c.value===curQ.c) score+=10
  let time=Date.now()-startTime
  if(time<3000) aiScore+=25
  loadQ()
}

function logCheat(reason,point){
  aiScore+=point
  logs.innerHTML+=`<li>${user.name}: ${reason} (+${point})</li>`
}

document.addEventListener("visibilitychange",()=>{
  if(document.hidden) logCheat("ThoÃ¡t tab",30)
})
document.addEventListener("copy",()=>logCheat("Copy",20))
document.addEventListener("paste",()=>logCheat("Paste",20))
window.addEventListener("resize",()=>logCheat("Resize",15))

function exportPDF(){
  const {jsPDF}=window.jspdf
  let pdf=new jsPDF()
  pdf.text(`Báº¢NG ÄIá»‚M`,20,20)
  pdf.text(`TÃªn: ${user.name}`,20,30)
  pdf.text(`Äiá»ƒm: ${score}`,20,40)
  pdf.text(`AI gian láº­n: ${aiScore}`,20,50)
  pdf.save("bang_diem.pdf")
}

// Admin AI Table
setInterval(()=>{
  if(user?.role==="admin"){
    aiTable.innerHTML=`<tr>
      <td>Há»c sinh A</td>
      <td>${aiScore}</td>
      <td>${aiScore>=60?"âš ï¸ Gian láº­n":"âœ” BÃ¬nh thÆ°á»ng"}</td>
    </tr>`
  }
},1000)
</script>

</body>
</html>
